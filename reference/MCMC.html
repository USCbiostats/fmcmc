<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Markov Chain Monte Carlo — MCMC • fmcmc</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Markov Chain Monte Carlo — MCMC"><meta property="og:description" content="A flexible implementation of the Metropolis-Hastings MCMC algorithm, users
can utilize arbitrary transition kernels as well as set-up an automatic
stop criterion using a convergence check test."><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-108627422-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-108627422-3');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fmcmc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5-1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/advanced-features.html">Advanced features</a>
    </li>
    <li>
      <a href="../articles/user-defined-kernels.html">User-defined kernels</a>
    </li>
    <li>
      <a href="../articles/workflow-with-fmcmc.html">Workflow with fmcmc</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/USCbiostats/fmcmc/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Markov Chain Monte Carlo</h1>
    <small class="dont-index">Source: <a href="https://github.com/USCbiostats/fmcmc/blob/HEAD/R/mcmc.R" class="external-link"><code>R/mcmc.R</code></a>, <a href="https://github.com/USCbiostats/fmcmc/blob/HEAD/R/mcmc_info.R" class="external-link"><code>R/mcmc_info.R</code></a></small>
    <div class="hidden name"><code>MCMC.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A flexible implementation of the Metropolis-Hastings MCMC algorithm, users
can utilize arbitrary transition kernels as well as set-up an automatic
stop criterion using a convergence check test.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">MCMC</span><span class="op">(</span>
  <span class="va">initial</span>,
  <span class="va">fun</span>,
  <span class="va">nsteps</span>,
  <span class="va">...</span>,
  seed <span class="op">=</span> <span class="cn">NULL</span>,
  nchains <span class="op">=</span> <span class="fl">1L</span>,
  burnin <span class="op">=</span> <span class="fl">0L</span>,
  thin <span class="op">=</span> <span class="fl">1L</span>,
  kernel <span class="op">=</span> <span class="fu"><a href="kernel_normal.html">kernel_normal</a></span><span class="op">(</span><span class="op">)</span>,
  multicore <span class="op">=</span> <span class="cn">FALSE</span>,
  conv_checker <span class="op">=</span> <span class="cn">NULL</span>,
  cl <span class="op">=</span> <span class="cn">NULL</span>,
  progress <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="va">multicore</span>,
  chain_id <span class="op">=</span> <span class="fl">1L</span>
<span class="op">)</span>

<span class="fu">MCMC_without_conv_checker</span><span class="op">(</span>
  <span class="va">initial</span>,
  <span class="va">fun</span>,
  <span class="va">nsteps</span>,
  <span class="va">...</span>,
  nchains <span class="op">=</span> <span class="fl">1L</span>,
  burnin <span class="op">=</span> <span class="fl">0L</span>,
  thin <span class="op">=</span> <span class="fl">1L</span>,
  kernel <span class="op">=</span> <span class="fu"><a href="kernel_normal.html">kernel_normal</a></span><span class="op">(</span><span class="op">)</span>,
  multicore <span class="op">=</span> <span class="cn">FALSE</span>,
  conv_checker <span class="op">=</span> <span class="cn">NULL</span>,
  cl <span class="op">=</span> <span class="cn">NULL</span>,
  progress <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="va">multicore</span>,
  chain_id <span class="op">=</span> <span class="fl">1L</span>
<span class="op">)</span>

<span class="va">MCMC_OUTPUT</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>initial</dt>
<dd><p>Either a numeric matrix or vector, or an object of class <a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">coda::mcmc</a>
or <a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">coda::mcmc.list</a> (see details).
initial values of the parameters for each chain (See details).</p></dd>
<dt>fun</dt>
<dd><p>A function. Returns the log-likelihood.</p></dd>
<dt>nsteps</dt>
<dd><p>Integer scalar. Length of each chain.</p></dd>
<dt>...</dt>
<dd><p>Further arguments passed to <code>fun</code>.</p></dd>
<dt>seed</dt>
<dd><p>If not null, passed to <a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a>.</p></dd>
<dt>nchains</dt>
<dd><p>Integer scalar. Number of chains to run (in parallel).</p></dd>
<dt>burnin</dt>
<dd><p>Integer scalar. Length of burn-in. Passed to
<a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">coda::mcmc</a> as <code>start</code>.</p></dd>
<dt>thin</dt>
<dd><p>Integer scalar. Passed to <a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">coda::mcmc</a>.</p></dd>
<dt>kernel</dt>
<dd><p>An object of class <a href="kernel_new.html">fmcmc_kernel</a>.</p></dd>
<dt>multicore</dt>
<dd><p>Logical. If <code>FALSE</code> then chains will be executed in serial.</p></dd>
<dt>conv_checker</dt>
<dd><p>A function that receives an object of class <a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">coda::mcmc.list</a>,
and returns a logical value with <code>TRUE</code> indicating convergence. See the
"Automatic stop" section and the <a href="convergence-checker.html">convergence-checker</a> manual.</p></dd>
<dt>cl</dt>
<dd><p>A <code>cluster</code> object passed to <a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parallel::clusterApply</a>.</p></dd>
<dt>progress</dt>
<dd><p>Logical scalar. When set to <code>TRUE</code> shows a progress bar. A new
bar will be show every time that the convergence checker is called.</p></dd>
<dt>chain_id</dt>
<dd><p>Integer scalar (internal use only). This is an argument
passed to the kernel function and it allows it identify in which of the
chains the process is taking place. This could be relevant for some kernels
(see <code><a href="kernel_new.html">kernel_new()</a></code>).</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p><code>MCMC</code> returns an object of class <a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">coda::mcmc</a> from the <a href="https://CRAN.R-project.org/package=coda" class="external-link"><span class="pkg">coda</span></a>package. The <code>mcmc</code> object is a matrix with one column per parameter,
and <code>nsteps</code> rows. If <code>nchains &gt; 1</code>, then it returns a <a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">coda::mcmc.list</a>.
While the main output of <code>MCMC</code> is the <code>mcmc</code>(<code>.list</code>) object, other information
and intermediate outputs of the process are stored in <code>MCMC_OUTPUT</code>. For information
about how to retrieve/set data, see <a href="mcmc-output.html">mcmc-output</a>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function implements Markov Chain Monte Carlo (MCMC) using the
Metropolis-Hastings ratio with
flexible transition kernels. Users can specify either one of the available
transition kernels or define one of their own (see <a href="kernel_new.html">kernels</a>). Furthermore,
it allows easy parallel implementation running multiple chains in parallel.
The function also allows using convergence diagnostics tests to set-up a
criterion for automatically stopping the algorithm  (see <a href="convergence-checker.html">convergence-checker</a>).</p>
<p>The canonical form of the Metropolis Hastings algorithm consists on accepting
a move from state \(x\) to state \(y\) based on the Hastings ratio \(r(x,y)\):</p>
<p>$$%
r(x,y) = \frac{h(y)q(y,x)}{h(x)q(x,y)},%
$$</p>
<p>where \(h\) is the unnormalized density of the specified distribution (
the posterior probability), and \(q\) has the conditional probability of
moving from state \(x\) to \(y\) (the proposal density). The move
\(x \to y\) is then accepted with probability</p>
<p>$$%
\alpha(x,y) = \min\left(1, r(x,y)\right)%
$$</p>
<p>Observe that, in the case that \(q()\) is symmetric, meaning \(q(x, y) = q(y, x)\),
the Hastings ration reduces to \(h(y)/h(x)\). Starting version 0.5-0, the value
of the log unnormalized density and the proposed states <code>y</code> can be accessed using
the functions <code><a href="mcmc-output.html">get_logpost()</a></code> and <code><a href="mcmc-output.html">get_draws()</a></code>.</p>
<p>We now give details of the
various options included in the function.</p>
<p>The function <code>MCMC_without_conv_checker</code> is for internal use
only.</p>
    </div>
    <div id="starting-point">
    <h2>Starting point</h2>
    


<p>By default, if <code>initial</code> is of class <code>mcmc</code>, <code>MCMC</code> will take the last <code>nchains</code>
points from the chain as starting point for the new sequence. If <code>initial</code> is
of class <code>mcmc.list</code>, the number of chains in <code>initial</code> must match the <code>nchains</code>
parameter.</p>
<p>If <code>initial</code> is a vector, then it must be of length equal to the number of
parameters used in the model. When using multiple chains, if <code>initial</code> is not
an object of class <code>mcmc</code> or <code>mcmc.list</code>, then it must be a numeric matrix
with as many rows as chains, and as many columns as parameters in the model.</p>
    </div>
    <div id="multiple-chains">
    <h2>Multiple chains</h2>
    


<p>When <code>nchains &gt; 1</code>, the function will run multiple chains. Furthermore,
if <code>cl</code> is not passed, <code>MCMC</code> will create a <code>PSOCK</code> cluster
using <code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makePSOCKcluster</a></code> with
<a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">parallel::detectCores</a>
clusters and attempt to execute using multiple cores. Internally, the function does
the following:</p>
<div class="sourceCode"><pre><code><span class="co"># Creating the cluster</span>
  <span class="va">ncores</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">ncores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">nchains</span> <span class="op">&lt;</span> <span class="va">ncores</span>, <span class="va">nchains</span>, <span class="va">ncores</span><span class="op">)</span>
  <span class="va">cl</span>     <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makePSOCKcluster</a></span><span class="op">(</span><span class="va">ncores</span><span class="op">)</span>
  
  <span class="co"># Loading the package and setting the seed using clusterRNGStream</span>
  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterEvalQ</a></span><span class="op">(</span><span class="va">cl</span>, <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USCbiostats/fmcmc" class="external-link">fmcmc</a></span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/RngStream.html" class="external-link">clusterSetRNGStream</a></span><span class="op">(</span><span class="va">cl</span>, <span class="va">.Random.seed</span><span class="op">)</span></code></pre></div>

<p>When running in parallel, objects that are
used within <code>fun</code> must be passed through <code>...</code>, otherwise the cluster
will return with an error.</p>
<p>The user controls the initial value of the parameters of the MCMC algorithm
using the argument <code>initial</code>. When using multiple chains, i.e., <code>nchains &gt; 1</code>,
the user can specify multiple starting points, which is recommended. In such a
case, each row of <code>initial</code> is use as a starting point for each of the
chains. If <code>initial</code> is a vector and <code>nchains &gt; 1</code>, the value is recycled, so
all chains start from the same point (not recommended, the function throws a
warning message).</p>
    </div>
    <div id="automatic-stop">
    <h2>Automatic stop</h2>
    


<p>By default, no automatic stop is implemented. If one of the functions in
<a href="convergence-checker.html">convergence-checker</a> is used, then the MCMC is done by bulks as specified
by the convergence checker function, and thus the algorithm will stop if,
the <code>conv_checker</code> returns <code>TRUE</code>. For more information see <a href="convergence-checker.html">convergence-checker</a>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Brooks, S., Gelman, A., Jones, G. L., &amp; Meng, X. L. (2011). Handbook of
Markov Chain Monte Carlo. Handbook of Markov Chain Monte Carlo.</p>
<p>Vega Yon, G., &amp; Marjoram, P. (2019). fmcmc: A friendly MCMC framework.
Journal of Open Source Software, 4(39), 1427. doi: <a href="https://doi.org/10.21105/joss.01427" class="external-link">10.21105/joss.01427</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="mcmc-output.html">get_logpost()</a></code>, <code><a href="mcmc-output.html">get_logpost()</a></code> (<a href="mcmc-output.html">mcmc-output</a>) for post execution of <code>MCMC</code>, and
<code><a href="mcmc-loop.html">ith_step()</a></code> for accessing objects within an <code>MCMC</code> call.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># Univariate distributed data with multiple parameters ----------------------</span></span>
<span class="r-in"><span class="co"># Parameters</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1231</span><span class="op">)</span></span>
<span class="r-in"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1e3</span></span>
<span class="r-in"><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2.6</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Generating data and writing the log likelihood function</span></span>
<span class="r-in"><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-in"><span class="va">fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">D</span>, <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Calling MCMC, but first, loading the coda R package for</span></span>
<span class="r-in"><span class="co"># diagnostics</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span></span>
<span class="r-in"><span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu">MCMC</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">fun</span>, initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mu<span class="op">=</span><span class="fl">1</span>, sigma<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, nsteps <span class="op">=</span> <span class="fl">2e3</span>,</span>
<span class="r-in">  kernel <span class="op">=</span> <span class="fu"><a href="kernel_normal.html">kernel_normal_reflective</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">.1</span>, ub <span class="op">=</span> <span class="fl">10</span>, lb <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span class="r-in">  <span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Ploting the output</span></span>
<span class="r-in"><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>no.readonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">ans</span><span class="op">)</span>, </span>
<span class="r-in">        main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Posterior distribution of"</span><span class="op">~</span><span class="va">mu</span><span class="op">~</span><span class="va">and</span><span class="op">~</span><span class="va">sigma</span><span class="op">)</span>,</span>
<span class="r-in">        names <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span class="r-in">        col  <span class="op">=</span> <span class="va">blues9</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">9</span><span class="op">)</span><span class="op">]</span>,</span>
<span class="r-in">        sub <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">mu</span> <span class="op">==</span> <span class="fu">.</span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">~</span><span class="st">", and"</span><span class="op">~</span><span class="va">sigma</span> <span class="op">==</span> <span class="fu">.</span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">pars</span>, col  <span class="op">=</span> <span class="va">blues9</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">9</span><span class="op">)</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">ans</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">fun</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span class="r-in">     main <span class="op">=</span> <span class="st">"LogLikelihood"</span>,</span>
<span class="r-in">     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">L</span><span class="op">(</span><span class="st">"{"</span><span class="op">~</span><span class="va">mu</span>,<span class="va">sigma</span><span class="op">~</span><span class="st">"}"</span><span class="op">~</span><span class="st">"|"</span><span class="op">~</span><span class="va">D</span><span class="op">)</span><span class="op">)</span> </span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-plt img"><img src="MCMC-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># In this example we estimate the parameter for a dataset with ----------------</span></span>
<span class="r-in"><span class="co"># With 5,000 draws from a MVN() with parameters M and S.</span></span>
<span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="co"># Loading the required packages</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://mvtnorm.R-forge.R-project.org" class="external-link">mvtnorm</a></span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in library(mvtnorm):</span> there is no package called ‘mvtnorm’</span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Parameters and data simulation</span></span>
<span class="r-in"><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.8</span>, <span class="fl">.2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span class="r-in"><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu">rmvnorm</span><span class="op">(</span><span class="fl">5e3</span>, mean <span class="op">=</span> <span class="va">M</span>, sigma <span class="op">=</span> <span class="va">S</span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in rmvnorm(5000, mean = M, sigma = S):</span> could not find function "rmvnorm"</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Function to pass to MCMC</span></span>
<span class="r-in"><span class="va">fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="co"># Putting the parameters in a sensible way</span></span>
<span class="r-in">  <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span class="r-in">  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">pars</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="va">pars</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">)</span></span>
<span class="r-in">  </span>
<span class="r-in">  <span class="co"># Computing the unnormalized log likelihood</span></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu">dmvnorm</span><span class="op">(</span><span class="va">D</span>, <span class="va">m</span>, <span class="va">s</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Calling MCMC</span></span>
<span class="r-in"><span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu">MCMC</span><span class="op">(</span></span>
<span class="r-in">  initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mu0<span class="op">=</span><span class="fl">5</span>, mu1<span class="op">=</span><span class="fl">5</span>, s0<span class="op">=</span><span class="fl">5</span>, s01<span class="op">=</span><span class="fl">0</span>, s2<span class="op">=</span><span class="fl">5</span><span class="op">)</span>, </span>
<span class="r-in">  <span class="va">fun</span>,</span>
<span class="r-in">  kernel  <span class="op">=</span> <span class="fu"><a href="kernel_normal.html">kernel_normal_reflective</a></span><span class="op">(</span></span>
<span class="r-in">    lb    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">.01</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">.01</span><span class="op">)</span>,</span>
<span class="r-in">    ub    <span class="op">=</span> <span class="fl">5</span>,</span>
<span class="r-in">    scale <span class="op">=</span> <span class="fl">0.01</span></span>
<span class="r-in">  <span class="op">)</span>,</span>
<span class="r-in">  nsteps  <span class="op">=</span> <span class="fl">1e3</span>,</span>
<span class="r-in">  thin    <span class="op">=</span> <span class="fl">10</span>,</span>
<span class="r-in">  burnin  <span class="op">=</span> <span class="fl">5e2</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in dmvnorm(D, m, s):</span> could not find function "dmvnorm"</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Checking out the outcomes</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span><span class="op">)</span></span>
<span class="r-plt img"><img src="MCMC-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ans</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iterations = 1:2000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Thinning interval = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of chains = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sample size per chain = 2000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. Empirical mean and standard deviation for each variable,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    plus standard error of the mean:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Mean     SD Naive SE Time-series SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu    2.481 0.2206 0.004934        0.04068</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma 2.931 0.1908 0.004267        0.03238</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2. Quantiles for each variable:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        2.5%   25%   50%   75% 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu    1.636 2.454 2.514 2.574 2.676</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma 2.657 2.908 2.953 3.000 3.095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Multiple chains -----------------------------------------------------------</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># As we want to run -fun- in multiple cores, we have to</span></span>
<span class="r-in"><span class="co"># pass -D- explicitly (unless using Fork Clusters)</span></span>
<span class="r-in"><span class="co"># just like specifying that we are calling a function from the</span></span>
<span class="r-in"><span class="co"># -mvtnorm- package.</span></span>
<span class="r-in">  </span>
<span class="r-in"><span class="va">fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">D</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="co"># Putting the parameters in a sensible way</span></span>
<span class="r-in">  <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span class="r-in">  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">pars</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="va">pars</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">)</span></span>
<span class="r-in">  </span>
<span class="r-in">  <span class="co"># Computing the unnormalized log likelihood</span></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu">dmvnorm</span><span class="op">(</span><span class="va">D</span>, <span class="va">m</span>, <span class="va">s</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Two chains</span></span>
<span class="r-in"><span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu">MCMC</span><span class="op">(</span></span>
<span class="r-in">  initial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mu0<span class="op">=</span><span class="fl">5</span>, mu1<span class="op">=</span><span class="fl">5</span>, s0<span class="op">=</span><span class="fl">5</span>, s01<span class="op">=</span><span class="fl">0</span>, s2<span class="op">=</span><span class="fl">5</span><span class="op">)</span>, </span>
<span class="r-in">  <span class="va">fun</span>,</span>
<span class="r-in">  nchains <span class="op">=</span> <span class="fl">2</span>,</span>
<span class="r-in">  kernel  <span class="op">=</span> <span class="fu"><a href="kernel_normal.html">kernel_normal_reflective</a></span><span class="op">(</span></span>
<span class="r-in">    lb    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">.01</span>, <span class="op">-</span><span class="fl">5</span>, <span class="fl">.01</span><span class="op">)</span>,</span>
<span class="r-in">    ub    <span class="op">=</span> <span class="fl">5</span>,</span>
<span class="r-in">    scale <span class="op">=</span> <span class="fl">0.01</span></span>
<span class="r-in">  <span class="op">)</span>,</span>
<span class="r-in">  nsteps  <span class="op">=</span> <span class="fl">1e3</span>,</span>
<span class="r-in">  thin    <span class="op">=</span> <span class="fl">10</span>,</span>
<span class="r-in">  burnin  <span class="op">=</span> <span class="fl">5e2</span>,</span>
<span class="r-in">  D       <span class="op">=</span> <span class="va">D</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>While using multiple chains, a single initial point has been passed via `initial`: c(5, 5, 5, 0, 5). The values will be recycled. Ideally you would want to start each chain from different locations.</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in loadNamespace(x):</span> there is no package called ‘mvtnorm’</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ans</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iterations = 1:2000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Thinning interval = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of chains = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sample size per chain = 2000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. Empirical mean and standard deviation for each variable,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    plus standard error of the mean:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Mean     SD Naive SE Time-series SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu    2.481 0.2206 0.004934        0.04068</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma 2.931 0.1908 0.004267        0.03238</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2. Quantiles for each variable:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        2.5%   25%   50%   75% 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu    1.636 2.454 2.514 2.574 2.676</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma 2.657 2.908 2.953 3.000 3.095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by George Vega Yon, National Cancer Institute (NCI).</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

